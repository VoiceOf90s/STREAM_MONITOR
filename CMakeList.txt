cmake_minimum_required(VERSION 3.15)
project(TwitchStreamMonitor VERSION 2.3.0 LANGUAGES CXX)

# Установка стандарта C++
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Поиск библиотеки CURL
find_package(CURL REQUIRED)

# Исходные файлы
set(SOURCES
    src/main.cpp
    src/Config.cpp
    src/Logger.cpp
    src/StringUtils.cpp
    src/HumanBehavior.cpp
    src/Notification.cpp
    src/Statistics.cpp
    src/TwitchApiClient.cpp
    src/BrowserController.cpp
    src/StreamMonitor.cpp
    src/MultiStreamMonitor.cpp
)

# Определение исполняемого файла
add_executable(stream_monitor ${SOURCES})

# Подключение заголовочных файлов
target_include_directories(stream_monitor PRIVATE
    ${CMAKE_CURRENT_SOURCE_DIR}/include
    ${CURL_INCLUDE_DIRS}
)

# Линковка библиотек
target_link_libraries(stream_monitor PRIVATE
    ${CURL_LIBRARIES}
)

# Windows-specific линковка
if(WIN32)
    target_link_libraries(stream_monitor PRIVATE ws2_32)
endif()

# Поддержка потоков
find_package(Threads REQUIRED)
target_link_libraries(stream_monitor PRIVATE Threads::Threads)

# Дополнительные флаги компиляции
if(MSVC)
    target_compile_options(stream_monitor PRIVATE /W4)
else()
    target_compile_options(stream_monitor PRIVATE -Wall -Wextra -pedantic)
endif()

# Установка в папку build
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR})

# Копирование конфигурационных файлов при сборке
file(COPY ${CMAKE_CURRENT_SOURCE_DIR}/config/config.ini 
     DESTINATION ${CMAKE_BINARY_DIR})
file(COPY ${CMAKE_CURRENT_SOURCE_DIR}/config/streamers.txt 
     DESTINATION ${CMAKE_BINARY_DIR})

# Создание папок для логов и статистики
file(MAKE_DIRECTORY ${CMAKE_BINARY_DIR}/logs)
file(MAKE_DIRECTORY ${CMAKE_BINARY_DIR}/stats)

# Сообщение о конфигурации
message(STATUS "═══════════════════════════════════════")
message(STATUS "Twitch Stream Monitor v2.3")
message(STATUS "═══════════════════════════════════════")
message(STATUS "  Project structure:")
message(STATUS "    Headers: include/")
message(STATUS "    Sources: src/")
message(STATUS "    Build:   build/")
message(STATUS "    Config:  config/")
message(STATUS "")
message(STATUS "  C++ Standard: ${CMAKE_CXX_STANDARD}")
message(STATUS "  Build Type: ${CMAKE_BUILD_TYPE}")
message(STATUS "  CURL Found: ${CURL_FOUND}")
message(STATUS "═══════════════════════════════════════")